<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
    <link rel="manifest" href="/favicon/site.webmanifest"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="/assets/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Monotonic" />
    <link rel="manifest" href="/assets/site.webmanifest" />

    <script src="https://kit.fontawesome.com/235894b977.js" crossorigin="anonymous"></script>    <title>Monotonic Radio</title>
</head> 

<body>
  <div id="content">
    <div id="play">
      <div class="colors">
          <div class="a-color blue"></div>
          <div class="a-color red"></div>
          <div class="a-color black"></div>
          <div class="a-color blue"></div>
          <div class="a-color red"></div>
          <div class="a-color black"></div>
          <div class="a-color blue"></div>
          <div class="a-color red"></div>
          <div class="a-color black"></div>
          <div class="a-color blue"></div>
          <div class="a-color red"></div>
          <div class="a-color black"></div>
          <div class="a-color blue"></div>
          <div class="a-color red"></div>
          <div class="a-color black"></div>   
          <div class="a-color blue"></div>
          <div class="a-color red"></div>
          <div class="a-color black"></div>                                                
      </div>

      <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M24 22h-24l12-20z"/></svg>
      <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" version="1.0" width="1262.000000pt" height="1280.000000pt" viewBox="0 0 1262.000000 1280.000000" preserveAspectRatio="xMidYMid meet"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="#FFFFFF" stroke="black"><path d="M669 12214 c-59 -18 -130 -81 -160 -141 l-24 -48 0 -5650 0 -5650 23 -47 c13 -26 43 -65 67 -87 83 -77 -104 -71 2295 -71 2400 0 2212 -6 2295 71 24 23 54 62 67 87 l23 47 0 5650 0 5650 -23 47 c-13 25 -43 64 -67 87 -83 77 105 71 -2299 70 -1824 0 -2158 -3 -2197 -15z"/><path d="M7542 12211 c-63 -22 -123 -76 -155 -141 l-22 -45 0 -5650 0 -5650 23 -47 c13 -25 43 -64 67 -87 83 -77 -105 -71 2295 -71 2399 0 2212 -6 2295 71 24 22 54 61 67 87 l23 47 0 5650 0 5650 -24 48 c-31 63 -101 123 -164 142 -44 13 -321 15 -2201 15 -2062 -1 -2153 -1 -2204 -19z"/></g></svg>
      <audio id="audio" src="https://monotonicradio.com/stream"></audio><p id="now-playing">{{ now_playing }}</p>
    </div>
    
    <div id="header">MONOTONIC RADIO &nbsp;<br id="line-break"><span id="live-status-offline">[<img src="assets/hourglass.png" class="live-icon"></img>OFFLINE ]</span><span id="live-status-online">[<img src="assets/play.png" class="live-icon"></img>ONLINE ]</span></div>

    <div id="pemdas"><br>
    <i></i>
    </div>

    <div id="stream-and-chat">

      <div id="video"><iframe id="stream"  class="stream"></iframe></div>
      
      <iframe id="chat" src="https://monotonicradio1.chatango.com/" class="scroll-transition-fade"></iframe>
      <p class="message"> if it gets buggy, refresh </p>
    </div>

<div id="circle" >
    <svg class="thumbnail" height="650" width="650">
        <defs>
          <clipPath id="circle-clip">
            <path d="M50 325A275 275 0 1 1 600 325A275 275 0 1 1 50 325"/>
          </clipPath>
          
          <pattern id="noise-pattern" x="0" y="0" width="100" height="100" patternUnits="userSpaceOnUse">
            <image href="assets/noise.gif" x="0" y="0" width="100" height="100"/>
          </pattern>
        </defs>

        <image id="thumbnail" href="{{ thumbnail }}" x="50" y="50" width="550" height="550" clip-path="url(#circle-clip)" preserveAspectRatio="xMidYMid slice"/>
        <rect x="50" y="50" width="550" height="550" fill="url(#noise-pattern)" clip-path="url(#circle-clip)" style="pointer-events: none; opacity: .25;"/>
    </svg>
    <div class="circle-txt"><svg height="650" width="650">
        <path id="ellipse-id-r1" style="fill: none;" d="M25 325A300 300 0 1 1 625 325A300 300 0 1 1 25 325"></path>
        <text><textPath xlink:href="#ellipse-id-r1"><tspan id="show-text">&nbsp;&nbsp;In the meantime, please enjoy Monotonic's digital archive selection → {{ now_playing }} →→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→</tspan></textPath></text>
    </svg></div>
    <div id="tune-in">
        <svg id="play-icon-circle" xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="white" stroke="black" style="border:1px solid black" d="M50 3L3 97h94z"/></svg>
      <svg id="pause-icon-circle" xmlns="http://www.w3.org/2000/svg" version="1.0" width="100" height="100" viewBox="0 0 1262.000000 1280.000000" preserveAspectRatio="xMidYMid meet"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="#FFFFFF" stroke="black" stroke-width="100"><path d="M669 12214 c-59 -18 -130 -81 -160 -141 l-24 -48 0 -5650 0 -5650 23 -47 c13 -26 43 -65 67 -87 83 -77 -104 -71 2295 -71 2400 0 2212 -6 2295 71 24 23 54 62 67 87 l23 47 0 5650 0 5650 -23 47 c-13 25 -43 64 -67 87 -83 77 105 71 -2299 70 -1824 0 -2158 -3 -2197 -15z"/><path d="M7542 12211 c-63 -22 -123 -76 -155 -141 l-22 -45 0 -5650 0 -5650 23 -47 c13 -25 43 -64 67 -87 83 -77 -105 -71 2295 -71 2399 0 2212 -6 2295 71 24 22 54 61 67 87 l23 47 0 5650 0 5650 -24 48 c-31 63 -101 123 -164 142 -44 13 -321 15 -2201 15 -2062 -1 -2153 -1 -2204 -19z"/></g></svg>
      </div>
</div>

<div id="circle-mobile">
    <svg class="thumbnail" height="325" width="325">
        <defs>
            <clipPath id="circle-clip-mobile">
                <path d="M25 162.5A137.5 137.5 0 1 1 300 162.5A137.5 137.5 0 1 1 25 162.5"/>
            </clipPath>
            <pattern id="noise-pattern-mobile" x="0" y="0" width="100" height="100" patternUnits="userSpaceOnUse">
              <image href="assets/noise.gif" x="0" y="0" width="100" height="100"/>
          </pattern>
        </defs>
        <image id="thumbnail-mobile" href="{{ thumbnail }}" x="25" y="25" width="275" height="275" clip-path="url(#circle-clip-mobile)" preserveAspectRatio="xMidYMid slice"/>
        <rect x="25" y="25" width="275" height="275" fill="url(#noise-pattern-mobile)" clip-path="url(#circle-clip-mobile)" style="pointer-events: none; opacity: .25;"/>
        <path id="blue-circle-mobile" style="fill: rgb(74, 128, 255); opacity: 0;" d="M25 162.5A137.5 137.5 0 1 1 300 162.5A137.5 137.5 0 1 1 25 162.5"></path>
    </svg>
    <div class="circle-txt">
        <svg height="325" width="325">
            <path id="ellipse-id-mobile" style="fill: none;" d="M12.5 162.5A150 150 0 1 1 312.5 162.5A150 150 0 1 1 12.5 162.5"></path>
            <text><textPath xlink:href="#ellipse-id-mobile"><tspan id="show-text-mobile">&nbsp;&nbsp;In the meantime, please enjoy Monotonic's digital archive selection → {{ now_playing }} →→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→→</tspan></textPath></text>
        </svg>
    </div>
    <div id="tune-in">
        <svg id="play-icon-circle-mobile" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100"><path fill="white" stroke="black" d="M50 3L3 97h94z"/></svg>
        <svg id="pause-icon-circle-mobile" xmlns="http://www.w3.org/2000/svg" version="1.0" width="50" height="50" viewBox="0 0 1262.000000 1280.000000" preserveAspectRatio="xMidYMid meet"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="#FFFFFF" stroke="black"  stroke-width="100"><path d="M669 12214 c-59 -18 -130 -81 -160 -141 l-24 -48 0 -5650 0 -5650 23 -47 c13 -26 43 -65 67 -87 83 -77 -104 -71 2295 -71 2400 0 2212 -6 2295 71 24 23 54 62 67 87 l23 47 0 5650 0 5650 -23 47 c-13 25 -43 64 -67 87 -83 77 105 71 -2299 70 -1824 0 -2158 -3 -2197 -15z"/><path d="M7542 12211 c-63 -22 -123 -76 -155 -141 l-22 -45 0 -5650 0 -5650 23 -47 c13 -25 43 -64 67 -87 83 -77 -105 -71 2295 -71 2399 0 2212 -6 2295 71 24 22 54 61 67 87 l23 47 0 5650 0 5650 -24 48 c-31 63 -101 123 -164 142 -44 13 -321 15 -2201 15 -2062 -1 -2153 -1 -2204 -19z"/></g></svg>
    </div>
</div>
    
  </div>

  <div class="footer">
    <div id="link-grid">
        <a class="icon-link" href="https://www.youtube.com/@MonotonicStudio" target="_blank"><img class="icon" src="assets/yt.png"></img></a>
        <a class="icon-link" href="https://soundcloud.com/monotonicradio" target="_blank"><img class="icon" style="height:90%; margin-top:-6px" src="assets/sc.png"></img></a>
        <a class="icon-link" href="https://www.instagram.com/monotonicradio/" target="_blank" ><img class="icon" src="assets/ig.png"></img></a>
    </div>
  </div>

</body>

<style>
  html, body {
    max-width: 100vw;
    overflow-x: hidden;
}

  .colors {
    overflow: hidden;
    position: absolute;
    z-index: -10;
    left: -20px;
    display: flex;
    will-change: transform;
    backface-visibility: hidden;
  }

  .a-color {
    width: 100px;
    height: 70px;
    transform: none !important;
    animation: none !important;
    will-change: transform;
    backface-visibility: hidden;
  }

  .black {
    background-color: black;
  }

  .red {
    background-color: rgba(240, 91, 24);
  }

  .blue {
    background-color: rgb(74, 128, 255);
  }

.thumbnail {
  animation: spin-reverse 120s linear infinite;
}

#circle {
  display: none;
  cursor: pointer;
  position: fixed;
  top: 55%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 650px;
  height: 650px;
}

#circle-mobile {
  cursor: pointer;
  position: fixed;
  top: 59%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 325px;
  height: 325px;
}

#circle > svg, #circle > .circle-txt {
  position: absolute;
  top: 0;
  left: 0;
  width: 650px;
  height: 650px;
}

#circle-mobile > svg, #circle-mobile > .circle-txt {
  position: absolute;
  top: 0;
  left: 0;
  width: 325px;
  height: 325px;
}

#tune-in {
  position: absolute;
  top: 49%;
  left: 53%;
  transform: translate(-50%, -50%);
}

.circle-txt {
  animation: spin 120s linear infinite;
}

@keyframes spin {
    to {
        transform:rotate(1turn)
    }
}

@keyframes spin-reverse {
    to {
        transform:rotate(-360deg)
    }
}

.footer{
    bottom: 0px;
    position: fixed;
    text-align: center ;
    align-items: center;
    font-size: 16px ;
    font-family: verdana ;
    width: 100% ;
    height: 70px ;
    background-color:rgb(255, 255, 255);
    display: flex;
    border-top: 1px solid black;
    border-bottom: 1px solid black;
}

  #link-grid {
    width: 100%;
    margin-top: 20px;
    height: 65px;
    display: flex;
    align-items: center;
  }

  body {
    font-family: 'Archivo Regular';
  }

  #pemdas {
    margin-top: 25px;
    line-height: 1.35em;
  }

  #live-status-online {
    display: none;
  }

  #play-icon {
    transform: rotate(90deg);
    margin-right: 15px;
  }

  #play-icon-circle {
    transform: rotate(90deg);
    margin-right: 15px;
  }


  #pause-icon-circle {
    display: none;
    margin-right: 30px;
  }

    #play-icon-circle-mobile {
    transform: rotate(90deg);
    margin-right: 15px;
  }


  #pause-icon-circle-mobile {
    display: none;
    margin-right: 30px;
  }

  #pause-icon {
    height: 25px;
    width: 24px;
    margin-right: 15px;
    display: none;
  }

  #play {
    overflow: hidden !important;
    background-color: rgba(74, 128, 255,1);
    transition: background-color 0.2s ease-in-out;
    cursor: pointer;
    padding-left: 20px;
    margin: auto;
    height: 70px;
    border-top: black 1px solid;
    border-bottom: black 1px solid;
    align-items: center;
    display: flex;
    width: 100%;

  }
  #chat {
    border: none; 
    width: 90%; 
    height: 540px; 
    transition-duration: initial;
  }

  #line-break { 
    display: block;
  }

  #video {
  position: relative;
  width: 100%;
  height: auto;
  }

  body {
    padding: 0;
    margin: 0;
    width: 100%;
    height: 100%;
  }

  #now-playing {
    font-family: 'Archivo SemiBold';
    text-align: left;
  }

  #video iframe {
    background-color: white;
    border: none;
    top: 0;
    left: 0;
    width: 100%;
    height: auto;
  }

  .live-icon {
    position: relative;
    top: 8px;
    height: 35px;
    margin-left: 5px;
    margin-right: 5px;
  }

  #live-status {
    font-family: 'Archivo Regular';
  }
  .message {
    font-family: 'Archivo Regular';
  }
  #stream-and-chat {
    margin-top: 50px;
    justify-content: center;
    display: block;
  }

  .icon {
    height:  70%;
  }

  .icon-link {
    display: flex;
    justify-content: center;
    height: 100%;
    margin:auto;
    width: 33.33%;  
}
  #content { 
    text-align: center;
  }
  #header {
    margin-top: 45px;
    font-family: 'Archivo Semibold';
    font-size:24pt;
    line-height: 0.5em;
  }
  @font-face {
      font-family: "Archivo SemiBold";
      src: url("assets/Archivo-SemiBold.ttf") format("truetype");
  }
  @font-face {
      font-family: "Archivo Regular";
      src: url("assets/Archivo-Regular.ttf") format("truetype");
  }
    @media screen and (min-width:769px) {

      #circle-mobile {
        display: none;
      }

      #circle {
        display:block;
      }

      #video iframe {
          width: 955px;
          height: 538px;
      }

      #video {
          width: 955px;
          height: 538px;
      }
      #line-break {
        display: none;
      }
      #stream-and-chat {
        display: flex;
      }
      #chat {
        width: 300px;
      }
      #header {
        font-size: 38pt;
      }
      .live-icon {
        top: 10px;
        height: 50px;
        margin-left: 10px;
        margin-right: 10px;
      }
      .icon {
        height: 70%;
      }
    }
</style>

<script>

const play = document.getElementById('play');
const circle = document.getElementById('circle');
const circleMobile = document.getElementById('circle-mobile');
const audio = document.getElementById('audio');
const pauseIcon = document.getElementById('pause-icon');
const playIcon = document.getElementById('play-icon');
const pauseIconCircle = document.getElementById('pause-icon-circle');
const playIconCircle = document.getElementById('play-icon-circle');
const pauseIconCircleMobile = document.getElementById('pause-icon-circle-mobile');
const playIconCircleMobile = document.getElementById('play-icon-circle-mobile');
const blueCircle = document.getElementById('blue-circle');
const blueCircleMobile = document.getElementById('blue-circle-mobile');

function toggle() {
  if (!audio.paused) {
    audio.pause();
    playIcon.style.display = 'block';
    pauseIcon.style.display = 'none';
    playIconCircle.style.display = 'block';
    pauseIconCircle.style.display = 'none';
    playIconCircleMobile.style.display = 'block';
    pauseIconCircleMobile.style.display = 'none';
    play.style.background = 'rgb(74, 128, 255)';
    play.style.color = 'black';
    //if (blueCircle) blueCircle.style.opacity = 0.8;
    //if (blueCircleMobile) blueCircleMobile.style.opacity = 0.8;
  }
  else {
    audio.play();
    setupMarquee('play');
    playIcon.style.display = 'none';
    pauseIcon.style.display = 'block';
    playIconCircle.style.display = 'none';
    pauseIconCircle.style.display = 'block';    
    playIconCircleMobile.style.display = 'none';
    pauseIconCircleMobile.style.display = 'block';
    play.style.background = 'rgba(0,0,0,0)';
    play.style.color = 'white';
    //if (blueCircle) blueCircle.style.opacity = 0;
    //if (blueCircleMobile) blueCircleMobile.style.opacity = 0;
  }
}

play.addEventListener('click', toggle);
if (circle) circle.addEventListener('click', toggle);
if (circleMobile) circleMobile.addEventListener('click', toggle);

const online = document.getElementById('live-status-online');
const offline = document.getElementById('live-status-offline');
const streamLink = document.getElementById('stream').src;
console.log('Stream');
console.log(streamLink);
const video = document.getElementById('stream-and-chat');

if (streamLink && streamLink.trim() !== '') {
    online.style.display = 'contents';
    offline.style.display = 'none';
    video.style.display = 'block';
    play.style.display = 'none';
} else {
    offline.style.display = 'contents';
    online.style.display = 'none';
    video.style.display = 'none';
    play.style.display = 'flex';
}

function updateMediaSession(title, artist, artwork) {
  if ('mediaSession' in navigator) {
    navigator.mediaSession.metadata = new MediaMetadata({
      title: title,
      artist: artist,
      album: 'Monotonic Radio',
      artwork: [
        { src: artwork, sizes: '96x96',   type: 'image/png' },
        { src: artwork, sizes: '128x128', type: 'image/png' },
        { src: artwork, sizes: '256x256', type: 'image/png' },
        { src: artwork, sizes: '512x512', type: 'image/png' }
      ]
    });

    navigator.mediaSession.setActionHandler('play', () => {
      audio.play();
    });
    
    navigator.mediaSession.setActionHandler('pause', () => {
      audio.pause();
    });
  }
}

const nowPlaying = document.getElementById('now-playing');
const showText = document.getElementById('show-text');
const showTextMobile = document.getElementById('show-text-mobile');
console.log(showText ? showText.textContent : 'showText not found');

const thumbnail = document.getElementById('thumbnail');
const thumbnailMobile = document.getElementById('thumbnail-mobile');

function getUpdatedInfo() {
    fetch('https://monotonicradio.com/info', {
        method: 'GET'
    })
    .then(function(response) { return response.json(); })
    .then(function(json) {
        if (json['thumbnail'] != thumbnail.getAttribute('href')) {
            console.log(thumbnail.getAttribute('href'));
            thumbnail.setAttribute('href', json['thumbnail']);
            thumbnailMobile.setAttribute('href', json['thumbnail']);
        }
        
        const remainingTime = Number(json['duration']) - Number(json['elapsed']);
        const endTime = new Date();
        endTime.setSeconds(endTime.getSeconds() + remainingTime);
        nowPlaying.innerHTML = json['now_playing'] + '<span style="font-family:Archivo Regular;"> - (Re-Run) - Until ' +  endTime.toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true }) + '</span>';
        
        const archiveText = "&nbsp;&nbsp;In the meantime, please enjoy Monotonic's digital archive selection → " + json["now_playing"] + " " + "-".repeat(200);
        if (showText) showText.innerHTML = archiveText;
        if (showTextMobile) showTextMobile.innerHTML = archiveText;

        updateMediaSession(json['now_playing'], 'Monotonic Radio', json['thumbnail']);
    });
}

getUpdatedInfo();
setInterval(getUpdatedInfo, 3000);


function setupMarquee(wrapperId, direction = 'left') {
  const wrapper = document.getElementById(wrapperId);
  if (!wrapper) return;

  const orgs = wrapper.querySelector('.colors');
  const originalItems = [...orgs.children];
  
  const clones = originalItems.map(item => item.cloneNode(true));
  
  if (direction === 'left') {
    clones.forEach(clone => orgs.appendChild(clone));
  } else {
    clones.reverse().forEach(clone => orgs.insertBefore(clone, orgs.firstChild));
  }

  orgs.offsetHeight;
  
  const totalWidth = originalItems.reduce((sum, el) => {
    const style = window.getComputedStyle(el);
    const marginRight = parseFloat(style.marginRight) || 0;
    return sum + el.offsetWidth + marginRight;
  }, 0);
  
  const duration = totalWidth / 50; // 75px/sec
  
  const uid = Math.random().toString(36).substr(2, 5);
  const animName = `scroll-${direction}-${uid}`;
  
  if (direction === 'left') {
    orgs.style.transform = 'translateX(0)';
  } else {
    orgs.style.transform = 'translateX(-50%)';
  }
  
  const style = document.createElement('style');
  if (direction === 'left') {
    style.textContent = `
      @keyframes ${animName} {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
      }
    `;
  } else {
    style.textContent = `
      @keyframes ${animName} {
        0% { transform: translateX(-50%); }
        100% { transform: translateX(0); }
      }
    `;
  }
  document.head.appendChild(style);
  
  orgs.style.cssText += `
    animation-name: ${animName};
    animation-duration: ${duration}s;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
    animation-fill-mode: forwards;
  `;
}

</script>